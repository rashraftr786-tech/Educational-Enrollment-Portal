<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baramulla Education Portal - Kreeri</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { background-color: #f1f5f9; padding-bottom: 60px; font-family: 'Inter', sans-serif; }
        .kashmir-header { background: #1e293b; color: white; padding: 25px; border-radius: 0 0 20px 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .section-card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #e2e8f0; }
        .member-card { background: #fff; border-left: 6px solid #3b82f6; border-radius: 10px; padding: 20px; margin-bottom: 15px; border: 1px solid #cbd5e1; }
        .dropout-box { background: #fff1f2; border: 1px solid #fecaca; padding: 15px; border-radius: 8px; margin-top: 15px; display: none; }
        label { font-size: 0.7rem; font-weight: 800; color: #64748b; text-transform: uppercase; margin-bottom: 5px; }
        .btn-save { background: #0f172a; color: white; font-weight: bold; padding: 12px; }
    </style>
</head>
<body>

<div class="kashmir-header text-center">
    <h3 class="fw-bold">üèîÔ∏è District Baramulla: Education Census</h3>
    <p class="mb-0 text-light opacity-75">Tehsils: Wagoora & Kreeri Mapping Active</p>
</div>

<div class="container mt-3" style="max-width: 900px;">
    
    <div class="section-card shadow-sm">
        <h6 class="fw-bold text-primary mb-3">üìç JURISDICTION (KREERI/WAGOORA)</h6>
        <div class="row g-3">
            <div class="col-md-4">
                <label>District</label>
                <select id="dist" class="form-select" onchange="updateTehsils()">
                    <option value="Baramulla">Baramulla</option>
                </select>
            </div>
            <div class="col-md-4">
                <label>Tehsil</label>
                <select id="teh" class="form-select" onchange="updateVillages()">
                    <option value="">Select Tehsil</option>
                    <option value="Kreeri">Kreeri</option>
                    <option value="Wagoora">Wagoora</option>
                    </select>
            </div>
            <div class="col-md-4">
                <label>Village</label>
                <select id="vil" class="form-select">
                    <option value="">Select Village</option>
                </select>
            </div>
        </div>
    </div>

    <div class="section-card shadow-sm">
        <div class="row g-3">
            <div class="col-md-4"><label>Habitation/Mohallah</label><input type="text" id="hab" class="form-control" placeholder="Mohallah Name"></div>
            <div class="col-md-4"><label>Head of Family</label><input type="text" id="head" class="form-control"></div>
            <div class="col-md-4"><label>House Type</label>
                <select id="houseType" class="form-select">
                    <option value="Pucca">Pucca</option><option value="Kuccha">Kuccha</option><option value="Rented">Rented</option>
                </select>
            </div>
            <div class="col-md-6"><label>Parent Mobile Number</label><input type="tel" id="mobile" class="form-control" maxlength="10"></div>
            <div class="col-md-6"><label>Category</label>
                <select id="cat" class="form-select">
                    <option value="General">General</option><option value="RBA">RBA</option><option value="ST">ST</option><option value="OBC">OBC</option><option value="EWS">EWS</option>
                </select>
            </div>
        </div>
    </div>

    <div id="membersContainer"></div>

    <div class="d-grid gap-3">
        <button class="btn btn-secondary" onclick="addMember()">+ ADD INDIVIDUAL</button>
        <button class="btn btn-save btn-lg" onclick="saveData()">üíæ SAVE HOUSEHOLD DATA</button>
        <hr>
        <button class="btn btn-outline-success" onclick="exportToExcel()">üìä DOWNLOAD KREERI/WAGOORA EXCEL</button>
    </div>
</div>

<script>
    const vilData = {
        "Kreeri": [
            "Kreeri", "Authoora", "Wailoo", "Check-i-Kanispora", "Dandusa", "Tapper", "Warpora", "Salosa", "Thalpora", "Nowpora", "Shrakwara", "Kalantra", "Kachwa", "Mirangund"
        ],
        "Wagoora": [
            "Bandi Payeen", "Chandoosa", "Daru Frastwari", "Doudbugh", "Durhama", "Jahangirpora", "Kachwa Muqam", "Mangam", "Murantangwari", "Najibhat", "Nilsar", "Sheerpora Gavgaran", "Shumlaran", "Sultanpora Kandi", "Tangwari Bala", "Tangwari Payeen", "Vizer", "Wagila", "Wagoora", "Wahdina", "Walraman", "Watergam"
        ]
    };

    function updateVillages() {
        const t = document.getElementById('teh').value;
        const vSel = document.getElementById('vil');
        vSel.innerHTML = '<option value="">Select Village</option>';
        if(vilData[t]) {
            vilData[t].forEach(v => vSel.add(new Option(v, v)));
        }
    }

    let db = JSON.parse(localStorage.getItem('BaramullaCensus')) || [];

    function addMember() {
        const container = document.getElementById('membersContainer');
        const div = document.createElement('div');
        div.className = 'member-card shadow-sm';
        div.innerHTML = `
            <div class="row g-2">
                <div class="col-md-6"><label>Name</label><input type="text" class="form-control mName"></div>
                <div class="col-md-3"><label>Age</label><input type="number" class="form-control mAge"></div>
                <div class="col-md-3"><label>Gender</label><select class="form-select mGen"><option>Female</option><option>Male</option></select></div>
            </div>
            <div class="mt-2"><label>Enrollment Status</label>
                <select class="form-select mStat" onchange="toggleDropout(this)">
                    <option value="Enrolled">Currently Enrolled</option>
                    <option value="Dropout">Dropout</option>
                    <option value="Never Enrolled">Never Enrolled</option>
                </select>
            </div>
            <div class="row g-2 mt-2 sch-info">
                <div class="col-md-6"><label>School Name</label><input type="text" class="form-control mSch"></div>
                <div class="col-md-6"><label>Class</label><input type="text" class="form-control mClass"></div>
            </div>
            <div class="dropout-box">
                <label class="text-danger small fw-bold">Dropout/Never Enrolled Analysis</label>
                <select class="form-select mReason"><option value="">Reason...</option><option>Financial</option><option>Distance</option><option>Disability</option><option>Household Work</option></select>
                <select class="form-select mt-2 mWilling"><option value="Yes">Willing to Rejoin?</option><option value="Yes">Yes</option><option value="No">No</option></select>
            </div>
        `;
        container.appendChild(div);
    }

    function toggleDropout(sel) {
        const card = sel.closest('.member-card');
        card.querySelector('.dropout-box').style.display = (sel.value === 'Enrolled') ? 'none' : 'block';
        card.querySelector('.sch-info').style.display = (sel.value === 'Enrolled') ? 'flex' : 'none';
    }

    function saveData() {
        const cards = document.querySelectorAll('.member-card');
        const hId = `BAR-${document.getElementById('teh').value.substring(0,3).toUpperCase()}-${Date.now().toString().slice(-4)}`;
        
        cards.forEach(c => {
            db.push({
                Tehsil: document.getElementById('teh').value,
                Village: document.getElementById('vil').value,
                Mohallah: document.getElementById('hab').value,
                HouseID: hId,
                Parent: document.getElementById('head').value,
                Mobile: document.getElementById('mobile').value,
                Name: c.querySelector('.mName').value,
                Age: c.querySelector('.mAge').value,
                Gender: c.querySelector('.mGen').value,
                Status: c.querySelector('.mStat').value,
                Reason: c.querySelector('.mReason').value,
                Willing: c.querySelector('.mWilling').value
            });
        });
        localStorage.setItem('BaramullaCensus', JSON.stringify(db));
        alert("Data Saved Successfully!");
        location.reload();
    }

    function exportToExcel() {
        const ws = XLSX.utils.json_to_sheet(db);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Data");
        XLSX.writeFile(wb, "Kreeri_Wagoora_Census.xlsx");
    }
</script>
</body>
</html>
                    
